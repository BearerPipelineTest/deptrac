imports:
  - deptrac.baseline.yaml

services:
  - class: IgnoreDependenciesOnUtils
    tags:
     - { name: event_listener, event: Qossmic\Deptrac\Events\Analyser\ProcessEvent }
  - class: IgnoreDependenciesOnEvents
    tags:
      - { name: event_listener, event: Qossmic\Deptrac\Events\Analyser\ProcessEvent }

deptrac:
  paths:
    - ./src

  formatters:
    graphviz:
      pointToGroups: true
      hidden_layers:
        - Utils
        - Events
      groups:
        Application:
          - Console
          - DependencyInjection
          - InputCollector
          - OutputFormatter
        Engine:
          - Ast
          - Result
          - Dependency
          - Layer

  layers:
    # Domains
    - name: Analyser
      collectors:
        - type: directory
          value: src/Analyser/.*
        - type: className
          value: ^JetBrains\\PHPStormStub\\.*
          private: true
    - name: Ast
      collectors:
        - type: directory
          value: src/Ast/.*
        - type: className
          value: ^PHPStan\\PhpDocParser\\.*
          private: true
        - type: className
          value: ^PhpParser\\.*
          private: true
        - type: className
          value: ^phpDocumentor\\Reflection\\.*
          private: true
    - name: Console
      collectors:
        - type: directory
          value: src/Console/.*
    - name: Dependency
      collectors:
        - type: directory
          value: src/Dependency/.*
    - name: DependencyInjection
      collectors:
        - type: directory
          value: src/DependencyInjection/.*
    - name: Events
      collectors:
        - type: directory
          value: src/Events/.*
    - name: InputCollector
      collectors:
        - type: directory
          value: src/InputCollector/.*
    - name: Layer
      collectors:
        - type: directory
          value: src/Layer/.*
    - name: OutputFormatter
      collectors:
        - type: directory
          value: src/OutputFormatter/.*
        - type: className
          value: ^phpDocumentor\\GraphViz\\.*
          private: true
    - name: Result
      collectors:
        - type: directory
          value: src/Result/.*
    - name: Utils
      collectors:
        - type: directory
          value: src/Utils/.*

  ruleset:
    Layer:
      - Ast
    Console:
      - Analyser
      - OutputFormatter
      - DependencyInjection
    Dependency:
      - Ast
    DependencyInjection:
      - Dependency
      - Console
    Result:
      - Dependency
      - Ast
    Analyser:
      - Result
      - Layer
      - Dependency
      - Console
      - InputCollector
      - Ast
      - DependencyInjection
    OutputFormatter:
      - Result
      - Console
      - Dependency
      - Ast
      - DependencyInjection
